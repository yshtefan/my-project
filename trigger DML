CREATE OR REPLACE TRIGGER trg_diseases_log
AFTER INSERT OR UPDATE OR DELETE ON diseases
FOR EACH ROW
BEGIN
  INSERT INTO diseases_log (
    id,
    disease_id,
    insured_id,
    operation_type,
    old_disease_name,
    new_disease_name,
    old_status,
    new_status,
    change_date,
    changed_by
  )
  VALUES (
    diseases_log_seq.NEXTVAL,   -- предполагается, что есть последовательность
    NVL(:OLD.disease_id, :NEW.disease_id),
    NVL(:OLD.insured_id, :NEW.insured_id),
    CASE
      WHEN INSERTING THEN 'INSERT'
      WHEN UPDATING THEN 'UPDATE'
      WHEN DELETING THEN 'DELETE'
    END,
    :OLD.disease_name,
    :NEW.disease_name,
    :OLD.status,
    :NEW.status,
    SYSDATE,
    USER
  );
END;
